<script>
  const calendarBody = document.getElementById('calendarBody');
  const monthSelect = document.getElementById('monthSelect');
  const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
  const year = new Date().getFullYear();

  // Populate month dropdown
  monthNames.forEach((m, i) => {
    const option = document.createElement('option');
    option.value = i;
    option.text = m;
    monthSelect.appendChild(option);
  });
  monthSelect.value = new Date().getMonth(); // select current month

  function getDaysInMonth(year, month) {
    return new Date(year, month + 1, 0).getDate();
  }

  function generateCalendar(year, month) {
    calendarBody.innerHTML = ''; 
    const daysInMonth = getDaysInMonth(year, month);
    const firstDay = new Date(year, month, 1).getDay();

    let row = document.createElement('tr');

    // Empty cells for alignment
    for (let i = 0; i < firstDay; i++) {
      row.appendChild(document.createElement('td'));
    }

    for (let day = 1; day <= daysInMonth; day++) {

      if (row.children.length === 7) {
        calendarBody.appendChild(row);
        row = document.createElement('tr');
      }

      const cell = document.createElement('td');
      cell.innerHTML = day + '<br>';

      // ----- âœ¨ LOAD ROUTINES FOR THIS DAY âœ¨ -----
      const saved = JSON.parse(localStorage.getItem("routines") || "[]");
      const thisDate = `${month + 1}/${day}/${year}`;
      const routinesForDay = saved.filter(r => r.date === thisDate);

      routinesForDay.forEach(r => {
        const p = document.createElement("div");
        p.textContent = "ðŸ“Œ " + r.name + " (" + r.totalTime + " min)";
        p.style.fontSize = "12px";
        p.style.marginTop = "4px";
        cell.appendChild(p);
      });
      // ------------------------------------------

      const button = document.createElement('button');
      button.textContent = "Add Routine";
      button.addEventListener('click', () => {
        window.location.href = `routine.html?year=${year}&month=${month+1}&day=${day}`;
      });

      cell.appendChild(button);
      row.appendChild(cell);
    }

    while (row.children.length < 7) {
      row.appendChild(document.createElement('td'));
    }
    calendarBody.appendChild(row);
  }

  generateCalendar(year, new Date().getMonth());

  monthSelect.addEventListener('change', () => {
    generateCalendar(year, parseInt(monthSelect.value));
  });
</script>
